
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>ListManagement.search.salesforce &#8212; List Management 4.0 documentation</title>
    <link rel="stylesheet" href="../../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for ListManagement.search.salesforce</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">salesforce.py</span>
<span class="sd">======================================================</span>
<span class="sd">Provides a set of actions to compare the Contact object</span>
<span class="sd">of a Salesforce CRM to a 3rd party list (excel, csv).</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">ListManagement.legacy.get_sf_adv_list</span> <span class="k">import</span> <span class="n">run</span>
    <span class="kn">from</span> <span class="nn">ListManagement.utility.general</span> <span class="k">import</span> <span class="n">create_path_name</span><span class="p">,</span> <span class="n">today</span>
    <span class="kn">from</span> <span class="nn">ListManagement.utility.pandas_helper</span> <span class="k">import</span> <span class="n">read_df</span><span class="p">,</span> <span class="n">save_df</span><span class="p">,</span> <span class="n">make_df</span><span class="p">,</span> <span class="n">is_null</span>
<span class="k">except</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">legacy.get_sf_adv_list</span> <span class="k">import</span> <span class="n">run</span>
    <span class="kn">from</span> <span class="nn">utility.gen_helper</span> <span class="k">import</span> <span class="n">create_path_name</span><span class="p">,</span> <span class="n">today</span>
    <span class="kn">from</span> <span class="nn">utility.pandas_helper</span> <span class="k">import</span> <span class="n">read_df</span><span class="p">,</span> <span class="n">save_df</span><span class="p">,</span> <span class="n">make_df</span><span class="p">,</span> <span class="n">is_null</span>

<span class="n">_todays_sfdc_advisor_list</span> <span class="o">=</span> <span class="s1">&#39;T:</span><span class="se">\\</span><span class="s1">Shared</span><span class="se">\\</span><span class="s1">FS2 Business Operations</span><span class="se">\\</span><span class="s1">Python Search Program&#39;</span> \
                            <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">Salesforce Data Files</span><span class="se">\\</span><span class="s1">SFDC Advisor List as of &#39;</span> \
                            <span class="o">+</span> <span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%m-</span><span class="si">%d</span><span class="s2">-%y&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.csv&#39;</span>


<div class="viewcode-block" id="Search"><a class="viewcode-back" href="../../../index.html#ListManagement.search.salesforce.Search">[docs]</a><span class="k">class</span> <span class="nc">Search</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Search object that orchestrates comparisons and parsing between</span>
<span class="sd">    source (3rd party, Finra, et al) data sets and target</span>
<span class="sd">    (Salesforce contact object) data sets.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Instantiates a bare Search object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span> <span class="o">=</span> <span class="n">log</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_today</span> <span class="o">=</span> <span class="n">today</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sfdc_file_check</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_SFDC_advisor_list</span> <span class="o">=</span> <span class="n">read_df</span><span class="p">(</span><span class="n">_todays_sfdc_advisor_list</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__preprocess_sfdc_list</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_search_fields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;AMPFMBRID&#39;</span><span class="p">,</span> <span class="s1">&#39;Email&#39;</span><span class="p">,</span> <span class="s1">&#39;LkupName&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_return_fields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;CRDNumber&#39;</span><span class="p">,</span> <span class="s1">&#39;AccountId&#39;</span><span class="p">,</span> <span class="s1">&#39;SourceChannel&#39;</span><span class="p">,</span>
                               <span class="s1">&#39;ContactID&#39;</span><span class="p">,</span> <span class="s1">&#39;Needs Info Updated?&#39;</span><span class="p">,</span> <span class="s1">&#39;BizDev Group&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_found_contacts</span> <span class="o">=</span> <span class="n">make_df</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_contacts_to_review</span> <span class="o">=</span> <span class="n">make_df</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_to_create</span> <span class="o">=</span> <span class="n">make_df</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_keep_cols</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_to_finra</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_is_crd_check</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_search_one_crd_additional</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_save_to_review_df</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_num_searches_performed</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_total_found</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_num_found_contacts</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_review_path</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_search_list</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_found_contact_path</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_to_create_path</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_list_type</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sec_files</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sec_path</span> <span class="o">=</span> <span class="s1">&#39;T:</span><span class="se">\\</span><span class="s1">Shared</span><span class="se">\\</span><span class="s1">FS2 Business Operations</span><span class="se">\\</span><span class="s1">Python Search Program</span><span class="se">\\</span><span class="s1">SEC_Data</span><span class="se">\\</span><span class="s1">&#39;</span> \
                         <span class="s1">&#39;Individuals</span><span class="se">\\</span><span class="s1">processed_data</span><span class="se">\\</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_today</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span>

    <span class="k">def</span> <span class="nf">_sfdc_file_check</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Helper method to see the Salesforce advisor list has been extracted and kicks off</span>
<span class="sd">        the appropriate processing if it has not.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            Nothing</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">_todays_sfdc_advisor_list</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Please wait. Downloading SFDC list, as today&#39;s file was not available.&quot;</span><span class="p">)</span>

            <span class="n">run</span><span class="p">(</span><span class="n">path_name</span><span class="o">=</span><span class="n">_todays_sfdc_advisor_list</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init_list_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Helper method which stores the list file&#39;s column names and determines if it&#39;s known, or not.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            Nothing</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_headers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search_list</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">values</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_keep_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_headers</span> <span class="k">if</span> <span class="s1">&#39;unknown&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">c</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span>

    <span class="k">def</span> <span class="nf">__preprocess_sfdc_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Helper method that pre-preprocesses our source SalesForce contact file.</span>
<span class="sd">            1) identify and keep only unique records (rows)</span>
<span class="sd">            2) convert the CRDNumber column to string type</span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            Nothing</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_SFDC_advisor_list</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">return_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_SFDC_advisor_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_SFDC_advisor_list</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_SFDC_advisor_list</span><span class="p">[</span><span class="s1">&#39;CRDNumber&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__data_preprocessing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">additional</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Helper method that attempts to clean the 3rd party list file.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        additional</span>
<span class="sd">            Boolean; default=False</span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            Nothing</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_search_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search_list</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_keep_cols</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_search_list</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_search_list</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_search_list</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">thresh</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">additional</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_search_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name_preprocessing</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_headers</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search_list</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_search_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lkup_name_address_processing</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_headers</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search_list</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_headers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search_list</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">values</span>

    <span class="k">def</span> <span class="nf">__check_list_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Helper method to subset the fields returned upon merging 3rd party list with SF,</span>
<span class="sd">        based on the source object.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            Nothing</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_list_type</span> <span class="o">!=</span> <span class="s1">&#39;BizDev Group&#39;</span><span class="p">:</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_return_fields</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_df_column_preprocessing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Helper method to encode columns in a data frame to &#39;utf-8&#39; based on the column&#39;s data type.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        df</span>
<span class="sd">            A pandas data frame object</span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            A transformed (and preprocessed) data frame object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;int64&#39;</span><span class="p">,</span> <span class="s1">&#39;float64&#39;</span><span class="p">,</span> <span class="s1">&#39;object&#39;</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">])):</span>
                    <span class="n">df</span><span class="p">[</span><span class="n">cell</span><span class="p">][</span><span class="n">count</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">cell</span><span class="p">][</span><span class="n">count</span><span class="p">]</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">,</span> <span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">df</span>

    <span class="k">def</span> <span class="nf">__join_headers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">header</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Helper method to combine merge key (header) and the metadata we want from SFDC to associate with</span>
<span class="sd">        an individual record (row) from a 3rd party list.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        header</span>
<span class="sd">            A string; Merge key, i.e. a column we will merge on</span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            List; Our key and the joined headers</span>
<span class="sd">            Examples</span>
<span class="sd">                (ex. [CRDNumber, ContactId, AccountId, SourceChannel, etc.])</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">joined_headers</span> <span class="o">=</span> <span class="p">[</span><span class="n">header</span><span class="p">]</span>
        <span class="p">[</span><span class="n">joined_headers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rf</span><span class="p">)</span> <span class="k">for</span> <span class="n">rf</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_return_fields</span><span class="p">]</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">joined_headers</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__create_meta_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">search_two</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Helper method to determine how a merged list (3rd party &amp; FS SFDC data) get&#39;s handled.</span>

<span class="sd">        Steps:</span>
<span class="sd">        ------</span>
<span class="sd">        1) Determine if this is the first, or second, set of searches against SFDC.</span>
<span class="sd">        2) If this is the second set of searches, then &#39;found contacts&#39; are only records that have a ContactID</span>
<span class="sd">        3) If this is the first set of searches then:</span>
<span class="sd">            a) If a CRD search is passed to the &#39;create_meta_data&#39; method:</span>
<span class="sd">                1a. &#39;found contacts&#39; are records that have a ContactID merged with the original data</span>
<span class="sd">                2a. If CRD&#39;s are provided for all records, set &#39;to_finra&#39; to False and rename the CRDNumber column</span>
<span class="sd">                3a. If the length of the search list and found contact list are not the same, we need to</span>
<span class="sd">                    perform additional searches to attempt to identify additional matches &amp; duplicate records.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        headers</span>
<span class="sd">            List; Contains the headers in a given pandas data frame.</span>
<span class="sd">        search_two</span>
<span class="sd">            Boolean; defaults to False. Used to denote if this is the second search or not.</span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            Nothing.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># TODO: may need to try and clean this method up, it&#39;s a bit confusing and messy.</span>
        <span class="k">if</span> <span class="n">search_two</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_found_contacts</span> <span class="o">=</span> <span class="n">read_df</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_found_contact_path</span><span class="p">)</span>
            <span class="n">finra_matched_to_sf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search_list</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_search_list</span><span class="p">[</span><span class="s1">&#39;ContactID&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Matched CRDs from FINRA to </span><span class="si">%s</span><span class="s1"> records in Salesforce&#39;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">finra_matched_to_sf</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_found_contacts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_found_contacts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">finra_matched_to_sf</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_crd_check</span> <span class="ow">and</span> <span class="s1">&#39;CRD Provided by List&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_headers</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_found_contacts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_found_contacts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_search_list</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_search_list</span><span class="p">[</span><span class="s1">&#39;ContactID&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search_list</span><span class="p">[</span><span class="s1">&#39;CRDNumber&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_search_list</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="ow">and</span> \
                        <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_search_list</span><span class="p">[</span><span class="s1">&#39;CRDNumber&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">nonzero</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_search_list</span><span class="o">.</span><span class="n">index</span><span class="p">):</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">_search_list</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;CRDNumber&#39;</span><span class="p">:</span> <span class="s1">&#39;CRD Provided by List&#39;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_to_finra</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_search_list</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_found_contacts</span><span class="o">.</span><span class="n">index</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_search_one_crd_additional</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;CRD Info provided for all contacts. Will not search FINRA, but will &#39;</span>
                                      <span class="s1">&#39;perform remaining standard searches to maximize match rate.&#39;</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_search_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search_list</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_search_list</span><span class="p">[</span><span class="s1">&#39;ContactID&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">]</span>
                        <span class="c1"># self._contacts_to_review = self._contacts_to_review.append(</span>
                        <span class="c1">#     self._search_list[self._search_list[&#39;ContactID&#39;] == &#39;&#39;], ignore_index=True)</span>
                        <span class="c1"># self.log.info(&#39;CRD Info provided for all contacts. Will not search FINRA.&#39;)</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_search_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search_list</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_search_list</span><span class="p">[</span><span class="s1">&#39;ContactID&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_search_list</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;CRDNumber&#39;</span><span class="p">:</span> <span class="s1">&#39;CRD Provided by List&#39;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_headers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search_list</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">values</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_search_list</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">if</span> <span class="s2">&quot;CRD Provided by List&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_headers</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_identify_to_review_records</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_search_list</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;CRD Provided by List&#39;</span><span class="p">:</span> <span class="s1">&#39;CRDNumber&#39;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_found_contacts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_found_contacts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_search_list</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_search_list</span><span class="p">[</span><span class="s1">&#39;ContactID&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">],</span>
                        <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_search_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search_list</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_search_list</span><span class="p">[</span><span class="s1">&#39;ContactID&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_search_list</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;CRDNumber&#39;</span><span class="p">:</span> <span class="s1">&#39;CRD Provided by List&#39;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_found_contacts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_found_contacts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_search_list</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_search_list</span><span class="p">[</span><span class="s1">&#39;CRDNumber&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">],</span>
                        <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_found_contacts</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;these were found&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_search_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search_list</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_search_list</span><span class="p">[</span><span class="s1">&#39;CRDNumber&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">]</span>

            <span class="k">for</span> <span class="n">r_field</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_return_fields</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search_list</span><span class="p">[</span><span class="n">r_field</span><span class="p">]</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">_identify_to_review_records</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Helper method that&#39;s used to help identify records that need to be manually reviewed.</span>

<span class="sd">        Steps:</span>
<span class="sd">        ------</span>
<span class="sd">        1) flag a record as needing review if:</span>
<span class="sd">            a) a SFDC CRDNumber is not null doesn&#39;t equal the CRD Provided by List Number.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            Nothing</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_search_list</span><span class="p">[</span><span class="s1">&#39;ToReview&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_search_list</span><span class="p">[</span><span class="s1">&#39;ToReview&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search_list</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;CRDNumber&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span> <span class="ow">and</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;CRDNumber&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;CRD Provided by List&quot;</span><span class="p">]</span> <span class="k">else</span> <span class="n">x</span><span class="p">[</span>
                <span class="s1">&#39;ToReview&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_search_list</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_contacts_to_review</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_contacts_to_review</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_search_list</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_search_list</span><span class="p">[</span><span class="s1">&#39;ToReview&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_search_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search_list</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_search_list</span><span class="p">[</span><span class="s1">&#39;ToReview&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search_list</span><span class="p">[</span><span class="s1">&#39;CRDNumber&#39;</span><span class="p">]</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search_list</span><span class="p">[</span><span class="s1">&#39;ToReview&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_save_to_review_df</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_search_list</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Identified </span><span class="si">%s</span><span class="s1"> contacts that need to be reviewed.&#39;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_contacts_to_review</span><span class="o">.</span><span class="n">index</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">__num_found</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">found_df</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Helper method to aggregate the number of found contacts throughout all iterations of the search process.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        found_df</span>
<span class="sd">            A pandas data frame.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            Nothing</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_num_found_contacts</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">found_df</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_total_found</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_found_contacts</span>

    <span class="k">def</span> <span class="nf">__search_and_merge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">search_fields</span><span class="p">,</span> <span class="n">search_two</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Helper method that actually performs the merging of data from 3rd party and SF list files.</span>

<span class="sd">        Steps:</span>
<span class="sd">        ------</span>
<span class="sd">        1) for each search field, determine if it&#39;s present in the 3rd party file&#39;s column names</span>
<span class="sd">        2) create a sliced data frame of SF data to include only columns we need in &#39;n&#39;th search (via join_headers)</span>
<span class="sd">        3) merge data from 3rd party and SF subsetted data frame, merging on the search header</span>
<span class="sd">        4) submit the merged 3rd party list to the create_metadata method to determine how the list</span>
<span class="sd">            should be further sliced for subsequent processing, or if all records were found.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        search_fields</span>
<span class="sd">            list of columns to search (pandas merge) on</span>
<span class="sd">        search_two</span>
<span class="sd">            Boolean; defaults to False. Used to denote if this is the second search or not.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            Nothing</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">search_fields</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_return_fields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;CRDNumber&#39;</span><span class="p">,</span> <span class="s1">&#39;AccountId&#39;</span><span class="p">,</span> <span class="s1">&#39;SourceChannel&#39;</span><span class="p">,</span> <span class="s1">&#39;ContactID&#39;</span><span class="p">,</span> <span class="s1">&#39;Needs Info Updated?&#39;</span><span class="p">,</span>
                                   <span class="s1">&#39;BizDev Group&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">header</span> <span class="ow">in</span> <span class="n">search_fields</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">header</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_headers</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_num_searches_performed</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Performing search #</span><span class="si">%s</span><span class="s1"> on </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_searches_performed</span><span class="p">,</span> <span class="n">header</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_joined_headers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__join_headers</span><span class="p">(</span><span class="n">header</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">_headers_and_ids</span> <span class="o">=</span> <span class="n">make_df</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_headers_and_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_SFDC_advisor_list</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_joined_headers</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_search_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search_list</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_headers_and_ids</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="n">header</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_search_list</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_num_searched_on</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_search_list</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__create_meta_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_headers</span><span class="p">,</span> <span class="n">search_two</span><span class="o">=</span><span class="n">search_two</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_num_remaining</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_search_list</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">__num_found</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_found_contacts</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Found </span><span class="si">%s</span><span class="s1"> on </span><span class="si">%s</span><span class="s1"> search.</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_found_contacts</span><span class="p">,</span> <span class="n">header</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_headers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search_list</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">values</span>

    <span class="k">def</span> <span class="nf">_crd_search</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">search_field</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;CRDNumber&#39;</span><span class="p">]):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Helper method to help properly guide the search process when matching on CRDNumbers.</span>

<span class="sd">        Steps:</span>
<span class="sd">        ------</span>
<span class="sd">        1) set the fields that will be returned to the 3rd party list from the SFDC file, and fill blank values</span>
<span class="sd">        2) merge the 3rd party list and SFDC file, leveraging the __search_and_merge method.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        search_field</span>
<span class="sd">            List; The field to use as our &#39;join on&#39;/&#39;merge on&#39; key during a search.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            Updated Search object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_is_crd_check</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_return_fields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;AccountId&#39;</span><span class="p">,</span> <span class="s1">&#39;SourceChannel&#39;</span><span class="p">,</span>
                               <span class="s1">&#39;Needs Info Updated?&#39;</span><span class="p">,</span> <span class="s1">&#39;ContactID&#39;</span><span class="p">,</span> <span class="s1">&#39;BizDev Group&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_search_list</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__search_and_merge</span><span class="p">(</span><span class="n">search_field</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">_lkup_name_address_processing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">headers</span><span class="p">,</span> <span class="n">search_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Helper method to create the LkupName search field, if the necessary columns are present,</span>
<span class="sd">        and pre-process them.</span>

<span class="sd">        Steps:</span>
<span class="sd">        ------</span>
<span class="sd">        1) Check if PostalCode and State are available in the data frame, and convert the data types to strings</span>
<span class="sd">        2) Loop through each row, and attempt to clean the Postal code.</span>
<span class="sd">        3) Attempt to clean the State column, if the name (rather than abbr.) is provided. leverage us.states.lookup</span>
<span class="sd">        4) Check if FirstName and LastName are present</span>
<span class="sd">            a) If all columns are present combine first 3 chars of First Name, Last Name, Account, State, and Postal</span>
<span class="sd">            b) Ex. RicSchools FS Investm PA 19112</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        headers</span>
<span class="sd">            List; list of column headers of the data frame.</span>
<span class="sd">        search_list</span>
<span class="sd">            A pandas data frame.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            An updated (enriched) pandas data frame object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;MailingPostalCode&quot;</span> <span class="ow">in</span> <span class="n">headers</span> <span class="ow">and</span> <span class="s2">&quot;MailingState&quot;</span> <span class="ow">in</span> <span class="n">headers</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">us</span>
            <span class="kn">import</span> <span class="nn">uszipcode</span>
            <span class="n">zs</span> <span class="o">=</span> <span class="n">uszipcode</span><span class="o">.</span><span class="n">ZipcodeSearchEngine</span><span class="p">()</span>

            <span class="n">search_list</span><span class="p">[</span><span class="s1">&#39;MailingPostalCode&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">search_list</span><span class="p">[</span><span class="s1">&#39;MailingPostalCode&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>

            <span class="n">search_list</span><span class="p">[</span><span class="s1">&#39;MailingPostalCode&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">search_list</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
                <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;MailingPostalCode&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;-&#39;</span> <span class="ow">in</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;MailingPostalCode&#39;</span><span class="p">]</span> <span class="k">else</span> <span class="n">x</span><span class="p">[</span>
                    <span class="s1">&#39;MailingPostalCode&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

            <span class="n">search_list</span><span class="p">[</span><span class="s1">&#39;MailingPostalCode&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">search_list</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
                <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;MailingPostalCode&#39;</span><span class="p">][:</span><span class="mi">5</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;MailingPostalCode&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">9</span> <span class="k">else</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;MailingPostalCode&#39;</span><span class="p">],</span>
                <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

            <span class="n">search_list</span><span class="p">[</span><span class="s1">&#39;MailingPostalCode&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">search_list</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
                <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;MailingPostalCode&#39;</span><span class="p">][:</span><span class="mi">4</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;MailingPostalCode&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">8</span> <span class="k">else</span> <span class="n">x</span><span class="p">[</span>
                    <span class="s1">&#39;MailingPostalCode&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">search_list</span><span class="p">[</span><span class="s1">&#39;MailingState&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">search_list</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
                    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">us</span><span class="o">.</span><span class="n">states</span><span class="o">.</span><span class="n">lookup</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;MailingState&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="p">,</span> <span class="n">use_cache</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">abbr</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span>
                        <span class="n">x</span><span class="p">[</span><span class="s1">&#39;MailingState&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="k">else</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;MailingState&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Unable to transform MailingState with the python &#39;us&#39; library.&quot;</span><span class="p">)</span>
                    <span class="n">search_list</span><span class="p">[</span><span class="s1">&#39;MailingState&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">search_list</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
                        <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">zs</span><span class="o">.</span><span class="n">by_zipcode</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;MailingPostalCode&#39;</span><span class="p">])[</span><span class="s1">&#39;State&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Unable to transform MailingState with the python &#39;uszipcode&#39; library.&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Will forgo attempting to transform MailingState&#39;</span><span class="p">)</span>

            <span class="sd">&quot;&quot;&quot; archaic code for zip below</span>
<span class="sd">            search_list[&#39;MailingPostalCode&#39;] = search_list[&#39;MailingPostalCode&#39;].astype(str)</span>
<span class="sd">            for index, row in search_list.iterrows():</span>
<span class="sd">                search_list.loc[index, &quot;MailingPostalCode&quot;] = row[&quot;MailingPostalCode&quot;].split(&#39;-&#39;)[0]</span>
<span class="sd">                if len(row[&quot;MailingPostalCode&quot;]) == 9:</span>
<span class="sd">                    search_list.loc[index, &quot;MailingPostalCode&quot;] = row[&quot;MailingPostalCode&quot;][:5]</span>
<span class="sd">                elif len(row[&quot;MailingPostalCode&quot;]) == 8:</span>
<span class="sd">                    search_list.loc[index, &quot;MailingPostalCode&quot;] = row[&quot;MailingPostalCode&quot;][:4]</span>

<span class="sd">            if np.mean(search_list[&#39;MailingState&#39;].str.len()) &gt; 2:</span>
<span class="sd">                import us</span>
<span class="sd">                self.log.info(&#39;MailingState column needs to be transformed.&#39;)</span>
<span class="sd">                for index, row in search_list.iterrows():</span>
<span class="sd">                    try:</span>
<span class="sd">                        state = us.states.lookup(search_list.loc[index, &quot;MailingState&quot;])</span>
<span class="sd">                        search_list.loc[index, &quot;MailingState&quot;] = str(state.abbr)</span>
<span class="sd">                    except:</span>
<span class="sd">                        pass</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">headers</span> <span class="o">=</span> <span class="n">search_list</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">values</span>
            <span class="k">if</span> <span class="s2">&quot;FirstName&quot;</span> <span class="ow">in</span> <span class="n">headers</span> <span class="ow">and</span> <span class="s2">&quot;LastName&quot;</span> <span class="ow">in</span> <span class="n">headers</span><span class="p">:</span>
                <span class="n">search_list</span><span class="p">[</span><span class="s2">&quot;FirstName&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">search_list</span><span class="p">[</span><span class="s2">&quot;FirstName&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">title</span><span class="p">())</span>
                <span class="n">search_list</span><span class="p">[</span><span class="s2">&quot;LastName&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">search_list</span><span class="p">[</span><span class="s2">&quot;LastName&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">title</span><span class="p">())</span>
                <span class="n">search_list</span><span class="p">[</span><span class="s2">&quot;Account&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">search_list</span><span class="p">[</span><span class="s2">&quot;Account&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
                <span class="n">search_list</span><span class="p">[</span><span class="s2">&quot;LkupName&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">search_list</span><span class="p">[</span><span class="s2">&quot;FirstName&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="n">search_list</span><span class="p">[</span><span class="s2">&quot;LastName&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">search_list</span><span class="p">[</span>
                                                                                                           <span class="s2">&quot;Account&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="p">[</span>
                                                                                                       <span class="p">:</span><span class="mi">10</span><span class="p">]</span> <span class="o">+</span> \
                                          <span class="n">search_list</span><span class="p">[</span><span class="s2">&quot;MailingState&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">search_list</span><span class="p">[</span><span class="s2">&quot;MailingPostalCode&quot;</span><span class="p">]</span>  <span class="c1"># .str[:-2]</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">search_list</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Advisor name or account information missing&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">search_list</span><span class="p">[</span><span class="s1">&#39;FinraLookup&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">search_list</span><span class="p">[</span><span class="s2">&quot;FirstName&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">search_list</span><span class="p">[</span><span class="s2">&quot;LastName&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> \
                                         <span class="n">search_list</span><span class="p">[</span><span class="s2">&quot;Account&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="p">[:</span><span class="mi">9</span><span class="p">]</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_to_finra</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="n">search_list</span>

    <span class="k">def</span> <span class="nf">_clean_comma_and_space</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">row</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Helper method to remove spaces and commas from a row within a data frame.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        row</span>
<span class="sd">            An un-normalized pandas data frame row containing spaces and commas.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            A normalized pandas data frame row void of spaces and commas.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s1">&#39; &#39;</span> <span class="ow">in</span> <span class="n">row</span><span class="p">:</span>
            <span class="n">row</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;,&#39;</span> <span class="ow">in</span> <span class="n">row</span><span class="p">:</span>
            <span class="n">row</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="s1">&#39;, &#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">row</span>

    <span class="k">def</span> <span class="nf">_name_preprocessing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">headers</span><span class="p">,</span> <span class="n">search_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Helper method to split and clean the FullName column of the 3rd party data frame.</span>

<span class="sd">        Steps:</span>
<span class="sd">        ------</span>
<span class="sd">        1) if FullName is present, create a column for First and Last Name.</span>
<span class="sd">        2) iterate through the data frame and if a comma is present in the Full Name, check if:</span>
<span class="sd">            a) a space preceeds a comma. if so, assume the 1st element of the split FullName is the First Name</span>
<span class="sd">                and the 2nd element is the Last Name.</span>
<span class="sd">            b) a comma preceeds a space. if so, assume the inverse of the previous statement.</span>
<span class="sd">        3) if no comma is present, assume First Last / (suffix or middle) - splitting the FullName on spaces (&#39; &#39;)</span>
<span class="sd">        4) attempt to remove potential suffixes (which may include .jr, iii, cfa, etc.)</span>
<span class="sd">        5) finally, attempt to appropriately assign the First and Last Name fields to the appropriate columns.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        headers</span>
<span class="sd">            List; columns names of a pandas data frame</span>
<span class="sd">        search_list</span>
<span class="sd">            A pandas data frame.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            An updated (enriched) pandas data frame object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">names_to_remove</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;jr&quot;</span><span class="p">,</span> <span class="s2">&quot;jr.&quot;</span><span class="p">,</span> <span class="s2">&quot;sr&quot;</span><span class="p">,</span> <span class="s2">&quot;sr.&quot;</span><span class="p">,</span> <span class="s2">&quot;ii&quot;</span><span class="p">,</span> <span class="s2">&quot;iii&quot;</span><span class="p">,</span> <span class="s2">&quot;iv&quot;</span><span class="p">,</span> <span class="s1">&#39;aams&#39;</span><span class="p">,</span> <span class="s1">&#39;aif&#39;</span><span class="p">,</span> <span class="s1">&#39;aifa&#39;</span><span class="p">,</span> <span class="s1">&#39;bcm&#39;</span><span class="p">,</span> <span class="s1">&#39;caia&#39;</span><span class="p">,</span>
                           <span class="s1">&#39;casl&#39;</span><span class="p">,</span> <span class="s1">&#39;ccps&#39;</span><span class="p">,</span> <span class="s1">&#39;cdfa&#39;</span><span class="p">,</span> <span class="s1">&#39;cea&#39;</span><span class="p">,</span> <span class="s1">&#39;cebs&#39;</span><span class="p">,</span> <span class="s1">&#39;ces&#39;</span><span class="p">,</span> <span class="s1">&#39;cfa&#39;</span><span class="p">,</span> <span class="s1">&#39;cfe&#39;</span><span class="p">,</span> <span class="s1">&#39;cfp&#39;</span><span class="p">,</span> <span class="s1">&#39;cfs&#39;</span><span class="p">,</span> <span class="s1">&#39;chfc&#39;</span><span class="p">,</span>
                           <span class="s1">&#39;chfcicap&#39;</span><span class="p">,</span> <span class="s1">&#39;chfebc&#39;</span><span class="p">,</span> <span class="s1">&#39;cic&#39;</span><span class="p">,</span> <span class="s1">&#39;cima&#39;</span><span class="p">,</span> <span class="s1">&#39;cis&#39;</span><span class="p">,</span> <span class="s1">&#39;cltc&#39;</span><span class="p">,</span> <span class="s1">&#39;clu&#39;</span><span class="p">,</span> <span class="s1">&#39;cpa&#39;</span><span class="p">,</span> <span class="s1">&#39;cpwa&#39;</span><span class="p">,</span> <span class="s1">&#39;crpc&#39;</span><span class="p">,</span>
                           <span class="s1">&#39;crps&#39;</span><span class="p">,</span> <span class="s1">&#39;csa&#39;</span><span class="p">,</span> <span class="s1">&#39;iar&#39;</span><span class="p">,</span> <span class="s1">&#39;jd&#39;</span><span class="p">,</span> <span class="s1">&#39;lutcf&#39;</span><span class="p">,</span> <span class="s1">&#39;mba&#39;</span><span class="p">,</span> <span class="s1">&#39;msa&#39;</span><span class="p">,</span> <span class="s1">&#39;msfp&#39;</span><span class="p">,</span> <span class="s1">&#39;pfs&#39;</span><span class="p">,</span> <span class="s1">&#39;phd&#39;</span><span class="p">,</span> <span class="s1">&#39;ppc&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="s2">&quot;FullName&quot;</span> <span class="ow">in</span> <span class="n">headers</span><span class="p">:</span>
            <span class="n">search_list</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;LastName&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="n">search_list</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;FirstName&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">search_list</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
                <span class="k">if</span> <span class="s1">&#39;,&#39;</span> <span class="ow">in</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;FullName&quot;</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;FullName&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;FullName&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">):</span>
                        <span class="n">search_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s2">&quot;FirstName&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;FullName&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">search_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s2">&quot;LastName&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;FullName&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">:])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">search_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s2">&quot;LastName&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;FullName&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">search_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s2">&quot;FirstName&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;FullName&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">full_name_list</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;FullName&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                    <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">full_name_list</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">names_to_remove</span><span class="p">:</span>
                            <span class="n">full_name_list</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">full_name_list</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">full_name_list</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                        <span class="n">search_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s2">&quot;FirstName&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">full_name_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">search_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s2">&quot;LastName&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">full_name_list</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">search_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s2">&quot;FirstName&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">full_name_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">search_list</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s2">&quot;LastName&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">full_name_list</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">search_list</span>

<div class="viewcode-block" id="Search.perform_search_one"><a class="viewcode-back" href="../../../index.html#ListManagement.search.salesforce.Search.perform_search_one">[docs]</a>    <span class="k">def</span> <span class="nf">perform_search_one</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">searching_list_path</span><span class="p">,</span> <span class="n">list_type</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        User method to implement the first comparison between a 3rd party list and Salesforce.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        searching_list_path</span>
<span class="sd">            String; Represents a full file path.</span>
<span class="sd">        list_type</span>
<span class="sd">            String; Represents the name of a Salesforce object.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            A python dictionary containing next steps for list processing.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Implementing search_one method on the </span><span class="si">%s</span><span class="s1"> list. Search 1 pre-processing begins.&#39;</span> <span class="o">%</span> <span class="n">list_type</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_search_list</span> <span class="o">=</span> <span class="n">read_df</span><span class="p">(</span><span class="n">searching_list_path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__init_list_metadata</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_list_type</span> <span class="o">=</span> <span class="n">list_type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__check_list_type</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__data_preprocessing</span><span class="p">(</span><span class="n">additional</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_found_contact_path</span> <span class="o">=</span> <span class="n">create_path_name</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">searching_list_path</span><span class="p">,</span> <span class="n">new_name</span><span class="o">=</span><span class="s1">&#39;_foundcontacts&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_review_contact_path</span> <span class="o">=</span> <span class="n">create_path_name</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">searching_list_path</span><span class="p">,</span> <span class="n">new_name</span><span class="o">=</span><span class="s1">&#39;_review_contacts&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_to_create_path</span> <span class="o">=</span> <span class="n">create_path_name</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">searching_list_path</span><span class="p">,</span> <span class="n">new_name</span><span class="o">=</span><span class="s1">&#39;to_create&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="s1">&#39;CRDNumber&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_headers</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_crd_check</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Performing a CRD search, as &#39;CRDNumber&#39; is present.&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_crd_search</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search_one_crd_additional</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Performing additional searches as the CRD search didn&#39;t find all records successfully.&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__search_and_merge</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_search_fields</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">_search_list</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;CRD Provided by List&#39;</span><span class="p">:</span> <span class="s1">&#39;CRDNumber&#39;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_to_create</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search_list</span><span class="p">[</span><span class="o">~</span><span class="n">is_null</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_search_list</span><span class="p">[</span><span class="s1">&#39;CRDNumber&#39;</span><span class="p">])]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_search_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search_list</span><span class="p">[</span><span class="n">is_null</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_search_list</span><span class="p">[</span><span class="s1">&#39;CRDNumber&#39;</span><span class="p">])]</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Performing standard search, as &#39;CRDNumber&#39; is not present.&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__search_and_merge</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_search_fields</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_save_to_review_df</span><span class="p">:</span>
            <span class="n">save_df</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_contacts_to_review</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_review_contact_path</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_to_create</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">save_df</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_to_create</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_to_create_path</span><span class="p">)</span>

        <span class="n">save_df</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_found_contacts</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_found_contact_path</span><span class="p">)</span>
        <span class="n">save_df</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_search_list</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">searching_list_path</span><span class="p">)</span>

        <span class="n">ret_item</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Next Step&#39;</span><span class="p">:</span> <span class="s1">&#39;FINRA Search&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;Found Path&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_found_contact_path</span><span class="p">,</span>
                    <span class="s1">&#39;SFDC_Found&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_found_contacts</span><span class="p">,</span>
                    <span class="s1">&#39;FINRA?&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_to_finra</span><span class="p">,</span>
                    <span class="s1">&#39;Review Path&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_review_contact_path</span><span class="p">,</span>
                    <span class="s1">&#39;to_create_path&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_to_create_path</span><span class="p">}</span>
        <span class="k">return</span> <span class="n">ret_item</span></div>

<div class="viewcode-block" id="Search.perform_search_two"><a class="viewcode-back" href="../../../index.html#ListManagement.search.salesforce.Search.perform_search_two">[docs]</a>    <span class="k">def</span> <span class="nf">perform_search_two</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">searching_list_path</span><span class="p">,</span> <span class="n">found_path</span><span class="p">,</span> <span class="n">list_type</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        User method to implement the second comparison between a 3rd party list and Salesforce.</span>

<span class="sd">        All advisors found during the call of this method are moved from the searching_list_path</span>
<span class="sd">        to the found_path.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        searching_list_path</span>
<span class="sd">            String; Represents a full file path of the un-matched advisors.</span>
<span class="sd">        found_path</span>
<span class="sd">            String; Represents a full file path of the matched advisors.</span>
<span class="sd">        list_type</span>
<span class="sd">            String; Represents the name of a Salesforce object.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            A python dictionary containing next steps for list processing.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Implementing search_two method on the </span><span class="si">%s</span><span class="s1"> list. Search 2 pre-processing begins.&#39;</span> <span class="o">%</span> <span class="n">list_type</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_search_fields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;CRDNumber&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_return_fields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;AccountId&#39;</span><span class="p">,</span> <span class="s1">&#39;SourceChannel&#39;</span><span class="p">,</span> <span class="s1">&#39;ContactID&#39;</span><span class="p">,</span>
                               <span class="s1">&#39;Needs Info Updated?&#39;</span><span class="p">,</span> <span class="s1">&#39;BizDev Group&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_found_contacts</span> <span class="o">=</span> <span class="n">read_df</span><span class="p">(</span><span class="n">found_path</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_search_list</span> <span class="o">=</span> <span class="n">read_df</span><span class="p">(</span><span class="n">searching_list_path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__init_list_metadata</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_keep_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search_list</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">c</span><span class="o">.</span><span class="n">lower</span><span class="p">()[:</span><span class="mi">7</span><span class="p">]</span><span class="o">.</span><span class="fm">__contains__</span><span class="p">(</span><span class="s1">&#39;unknown&#39;</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_list_type</span> <span class="o">=</span> <span class="n">list_type</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__check_list_type</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__data_preprocessing</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Searching against SFDC following FINRA/SEC searches.&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__search_and_merge</span><span class="p">(</span><span class="n">search_fields</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_search_fields</span><span class="p">,</span> <span class="n">search_two</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">save_df</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_found_contacts</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">found_path</span><span class="p">)</span>
        <span class="n">save_df</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_search_list</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">searching_list_path</span><span class="p">)</span>

        <span class="n">ret_item</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Next Step&#39;</span><span class="p">:</span> <span class="s1">&#39;Upload Prep&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;Found in SFDC Search #2&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_found_contacts</span><span class="p">}</span>
        <span class="k">return</span> <span class="n">ret_item</span></div>

<div class="viewcode-block" id="Search.perform_sec_search"><a class="viewcode-back" href="../../../index.html#ListManagement.search.salesforce.Search.perform_sec_search">[docs]</a>    <span class="k">def</span> <span class="nf">perform_sec_search</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">searching_list_path</span><span class="p">,</span> <span class="n">found_path</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sec_path</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Skipping SEC Search. Today&#39;s files could not be found in the listed directory.&quot;</span><span class="p">)</span>
            <span class="n">ret_item</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Next Step&#39;</span><span class="p">:</span> <span class="s1">&#39;SFDC Search #2&#39;</span><span class="p">,</span> <span class="s1">&#39;SEC_Found&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
            <span class="k">return</span> <span class="n">ret_item</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Searching against SEC Data.&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_search_list</span> <span class="o">=</span> <span class="n">read_df</span><span class="p">(</span><span class="n">searching_list_path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__init_list_metadata</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sec_files</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sec_path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_search_fields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;LkupName&#39;</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">sec</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sec_files</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_sec_df</span> <span class="o">=</span> <span class="n">read_df</span><span class="p">(</span><span class="n">sec</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_sec_df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;indvlPK&#39;</span><span class="p">:</span> <span class="s1">&#39;CRDNumber&#39;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__search_and_merge</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_search_fields</span><span class="p">)</span>

        <span class="n">save_df</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_found_contacts</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">found_path</span><span class="p">)</span>
        <span class="n">save_df</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_search_list</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">searching_list_path</span><span class="p">)</span>

        <span class="n">ret_item</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Next Step&#39;</span><span class="p">:</span> <span class="s1">&#39;SFDC Search #2&#39;</span><span class="p">,</span> <span class="s1">&#39;SEC_Found&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_found_contacts</span><span class="p">}</span>
        <span class="k">return</span> <span class="n">ret_item</span></div></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../../index.html">List Management</a></h1>








<h3>Navigation</h3>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../index.html">Documentation overview</a><ul>
  <li><a href="../../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2018, Ricky Schools.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.8.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.10</a>
      
    </div>

    

    
  </body>
</html>